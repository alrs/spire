# Server plugin: UpstreamCA "disk"

The `disk` plugin loads CA credentials from disk, using them to generate
intermediate signing certificates for the server's signing authority. The
intermediate certificates are minted against CSRs generated by the ServerCA
plugin.

The `disk` plugin reloads CA credentials on all CSR requests. If the
credentials cannot be loaded, then the previously loaded credentials will be used.
This provides two things: first, it ensures that the spire-server process does not
need to be restarted to load a new UpstreamCA from disk, providing a seamless rotation;
second, it ensures that a failed disk does not effect a running spire-server until the
loaded UpstreamCA expires.

The plugin accepts the following configuration options:

| Configuration   | Description                                          |
| ----------------| ---------------------------------------------------- |
| ttl             | The TTL for issued certificates (deprecated)         |
| cert_file_path  | Path to the "upstream" CA certificate that corresponds to the signing key. |
| key_file_path   | Path to the "upstream" CA key file. Key files must contain a single PEM encoded key. The supported key types are EC (ASN.1 or PKCS8 encoded) or RSA (PKCS1 or PKCS8 encoded).|
| bundle_file_path| If the certificate specified above is not a root certificate, but has been signed by a different root authority, then it is also necessary to specify the certificate bundle so that the full trust chain can be verified. The certificate bundle file shouldÂ contain a chain of certificates, in PEM format, up to the trusted root. If the certificate specified above is a root (that is, self-signed) certificate, then this does not need to be configured. |

The `ttl` configurable is deprecated. When unset, the plugin will use the
preferred TTL from SPIRE server, corresponding to the SPIRE server `ca_ttl`
configurable.

The `disk` plugin is able to function as either a root CA, or join an existing PKI.

When joining an existing PKI, the trust bundle for that PKI MUST be set explicitly
using the `bundle_file_path` option; this MUST contain the certificates of the trusted
roots for the PKI being joined in PEM format. When using the `bundle_file_path` option
`cert_file_path` MUST contain a chain of certificates, in PEM format, up to the trusted 
root. 

When functioning as a root CA, the trust bundle is unused. The `cert_file_path` MUST contain
exactly one certificate which is self-signed and `key_file_path` MUST contain the key for
that certificate.

Key files must contain a single PEM encoded key. The supported key types are EC (ASN.1 or PKCS8 encoded) or RSA (PKCS1 or PKCS8 encoded).

A sample configuration:

```
    UpstreamCA "disk" {
        plugin_data {
            cert_file_path = "conf/server/dummy_upstream_ca.crt"
            key_file_path = "conf/server/dummy_upstream_ca.key"
        }
    }
```
